!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/forms"),require("@angular/cdk/collections"),require("rxjs/operators"),require("@angular/material"),require("@ctrl/ngx-csv"),require("@angular/core"),require("@angular/common"),require("@angular/router")):"function"==typeof define&&define.amd?define("ngx-auto-table-lib",["exports","@angular/forms","@angular/cdk/collections","rxjs/operators","@angular/material","@ctrl/ngx-csv","@angular/core","@angular/common","@angular/router"],t):t(e["ngx-auto-table-lib"]={},e.ng.forms,e.ng.cdk.collections,e.rxjs.operators,e.ng.material,e.ngxCsv,e.ng.core,e.ng.common,e.ng.router)}(this,function(e,t,n,r,o,i,a,l,s){"use strict";var c=function(){return(c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function u(r,o){var i,a,l,e,s={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:t(0),"throw":t(1),"return":t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function n(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,a&&(l=2&e[0]?a["return"]:e[0]?a["throw"]||((l=a["return"])&&l.call(a),0):a.next)&&!(l=l.call(a,e[1])).done)return l;switch(a=0,l&&(e=[2&e[0],l.value]),e[0]){case 0:case 1:l=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,a=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(l=0<(l=s.trys).length&&l[l.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!l||e[1]>l[0]&&e[1]<l[3])){s.label=e[1];break}if(6===e[0]&&s.label<l[1]){s.label=l[1],l=e;break}if(l&&s.label<l[2]){s.label=l[2],s.ops.push(e);break}l[2]&&s.ops.pop(),s.trys.pop();continue}e=o.call(r,s)}catch(t){e=[6,t],a=0}finally{i=l=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([t,e])}}}function d(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)a.push(r.value)}catch(l){o={error:l}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return a}var p=function(){function e(){this.selectedBulk=new a.EventEmitter,this.columnDefinitions={},this.columnDefinitionsAll={},this.columnDefinitionsAllArray=[],this.headerKeysAll=[],this.headerKeysAllVisible=[],this.headerKeysDisplayed=[],this.headerKeysDisplayedMap={},this.pageSize=25,this.filterControl=new t.FormControl,this.selectionMultiple=new n.SelectionModel(!0,[]),this.selectionSingle=new n.SelectionModel(!1,[])}return e.prototype.ngOnInit=function(){var n=this;this.dataSourceSubscription=this.config.data$.pipe(r.filter(function(e){return!!e})).subscribe(function(e){if(console.log("ngx-auto-table, subscribed: ",{originalData:e}),n.dataSource=new o.MatTableDataSource(e),n.dataSource.paginator=n.paginator,n.dataSource.sort=n.sort,!e||e.length){n.hasNoItems=!1,n.config.pageSize&&(n.pageSize=n.config.pageSize);var t=e[0];n.initDisplayedColumns(t),n.initExport(e),n.initFilter(e)}else n.hasNoItems=!0}),this.config.clearSelected&&(this.clearSelectedSubscription=this.config.clearSelected.subscribe(function(){console.log("ngx-auto-table: clearSelected"),n.selectionMultiple.clear(),n.selectionSingle.clear()}))},e.prototype.ngOnDestroy=function(){this.dataSourceSubscription&&this.dataSourceSubscription.unsubscribe(),this.clearSelectedSubscription&&this.clearSelectedSubscription.unsubscribe()},e.prototype.applyFilter=function(e){this.dataSource.filter=e.trim().toLowerCase(),this.selectionMultiple.clear(),this.selectionSingle.clear()},e.prototype.initFilter=function(e){if(e.length){var t=e[0],n=new Set(Object.keys(t)),c=new Set(this.headerKeysDisplayed);c["delete"]("__bulk"),c["delete"]("__star");var u=Array.from(c).reduce(function(e,t){return n.has(t)&&e},!0);console.log("ngx-auto-table: initFilter()",{rowFields:n,allFieldsExist:u,headerKeysDisplayed:this.headerKeysDisplayed}),this.dataSource.filterPredicate=function(e,t){var n,r;if(!t)return!0;if(!u)return JSON.stringify(e).toLowerCase().includes(t);try{for(var o=function l(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(Array.from(c)),i=o.next();!i.done;i=o.next()){var a=e[i.value];if(JSON.stringify(a).toLowerCase().includes(t))return!0}}catch(s){n={error:s}}finally{try{i&&!i.done&&(r=o["return"])&&r.call(o)}finally{if(n)throw n.error}}}}},e.prototype.initExport=function(e){var t=this;this.exportFilename=this.config.exportFilename,this.exportFilename&&(this.exportData=e.map(function(e){return t.config.exportRowFormat?t.config.exportRowFormat(e):e}))},e.prototype.getKeyHeader=function(e){var t=this.columnDefinitions[e];return t&&null!=t.header?t.header:this.toTitleCase(e)},e.prototype.toTitleCase=function(e){return e.replace("_"," ").replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},e.prototype.initDisplayedColumns=function(e){if(this.initColumnDefinitions(e),this.headerKeysAll=Object.keys(this.columnDefinitionsAll),this.headerKeysAllVisible=this.headerKeysAll,this.config.hideFields){var t=new Set(this.config.hideFields);this.headerKeysAllVisible=this.headerKeysAll.filter(function(e){return!t.has(e)})}var n=this.columnDefinitionsAllArray.filter(function(e){return!e.hide}).map(function(e){return e.field});this.setDisplayedColumns(n),this.filterControl.setValue(this.headerKeysDisplayed)},e.prototype.initColumnDefinitions=function(e){var n=this,t=Object.keys(this.columnDefinitions);t.forEach(function(e){var t=n.columnDefinitions[e];n.columnDefinitionsAll[e]={header:n.getKeyHeader(e),template:t.template,hide:t.hide,forceWrap:t.forceWrap}}),Object.keys(e).forEach(function(e){n.columnDefinitionsAll[e]||(n.columnDefinitionsAll[e]={header:n.toTitleCase(e),hide:!0})}),this.columnDefinitionsAllArray=Object.keys(this.columnDefinitionsAll).map(function(e){return c({},n.columnDefinitionsAll[e],{field:e})}),console.log("ngx-auto-table: initColumnDefinitions",{firstDataItem:e,inputDefintionFields:t})},e.prototype.setDisplayedColumns=function(e){var t=this;this.headerKeysAllVisible.forEach(function(e){return t.headerKeysDisplayedMap[e]=!1}),e.forEach(function(e){return t.headerKeysDisplayedMap[e]=!0}),this.headerKeysDisplayed=Object.keys(this.headerKeysDisplayedMap).filter(function(e){return t.headerKeysDisplayedMap[e]}),this.config.actionsBulk&&this.headerKeysDisplayed.unshift("__bulk"),this.config.actions&&this.headerKeysDisplayed.push("__star")},e.prototype.isAllSelected=function(){var e=this.selectionMultiple.selected.length;return(this.config.bulkSelectMaxCount||this.dataSource.filteredData.length)<=e},e.prototype.masterToggle=function(){this.isAllSelected()?this.selectionMultiple.clear():this.selectAll(),this.selectedBulk.emit(this.selectionMultiple.selected)},e.prototype.selectAll=function(){var t=this;this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort);var e=this.dataSource.filteredData;this.config.bulkSelectMaxCount&&(e=this.dataSource.filteredData.slice(0,this.config.bulkSelectMaxCount)),e.forEach(function(e){t.selectionMultiple.select(e)})},e.prototype.isMaxReached=function(){return!!this.config.bulkSelectMaxCount&&this.selectionMultiple.selected.length>=this.config.bulkSelectMaxCount},e.prototype.onColumnFilterChange=function(e){console.log({$event:e});var t=this.filterControl.value;this.setDisplayedColumns(t),this.initFilter(this.dataSource.data)},e.prototype.onClickBulkItem=function(e,t){if(e){var n=this.selectionMultiple.isSelected(t);this.isMaxReached()?n?this.selectionMultiple.deselect(t):this.warn('Max Selection of "'+this.config.bulkSelectMaxCount+'" Reached'):this.selectionMultiple.toggle(t),this.selectedBulk.emit(this.selectionMultiple.selected)}},e.prototype.onClickRow=function(e,t){console.log("ngx-auto-table: onClickRow()",{$event:e,row:t}),this.config.onSelectItem&&(this.selectionSingle.select(t),this.config.onSelectItem(t))},e.prototype.onClickBulkAction=function(t){return function e(t,a,l,s){return new(l||(l=Promise))(function(e,n){function r(e){try{i(s.next(e))}catch(t){n(t)}}function o(e){try{i(s["throw"](e))}catch(t){n(t)}}function i(t){t.done?e(t.value):new l(function(e){e(t.value)}).then(r,o)}i((s=s.apply(t,a||[])).next())})}(this,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:return[4,t.onClick(this.selectionMultiple.selected)];case 1:return e.sent(),this.selectionMultiple.clear(),[2]}})})},e.prototype.warn=function(e){},e.decorators=[{type:a.Component,args:[{selector:"ngx-auto-table",template:'<div\r\n  class="table-header auto-elevation overflow-hidden"\r\n  [class.addRightPixel]="config.hideHeader"\r\n  *ngIf="(!config.hideFilter || !config.hideChooseColumns) && !hasNoItems"\r\n>\r\n  <div class="relative">\r\n    <div class="filters-container flex-h align-center space-between">\r\n      <mat-form-field class="filter" *ngIf="!hasNoItems && !config.hideFilter">\r\n        <mat-icon matPrefix>search</mat-icon>\r\n        <input\r\n          matInput\r\n          (keyup)="applyFilter($event.target.value)"\r\n          placeholder="Search Rows..."\r\n          #filterField\r\n        />\r\n        <mat-icon\r\n          class="has-pointer"\r\n          matSuffix\r\n          (click)="filterField.value = \'\'; applyFilter(filterField.value)"\r\n          >clear</mat-icon\r\n        >\r\n      </mat-form-field>\r\n      <mat-form-field\r\n        class="filter-columns overflow-hidden"\r\n        *ngIf="!hasNoItems && !config.hideChooseColumns"\r\n      >\r\n        <mat-icon matPrefix>view_column</mat-icon>\r\n        <mat-select\r\n          placeholder="Choose Columns..."\r\n          [formControl]="filterControl"\r\n          (selectionChange)="onColumnFilterChange($event)"\r\n          multiple\r\n        >\r\n          <mat-option *ngFor="let key of headerKeysAllVisible" [value]="key">\r\n            {{ getKeyHeader(key) }}\r\n          </mat-option>\r\n        </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n    <div\r\n      class="bulk-actions flex-h align-center space-between"\r\n      *ngIf="config.actionsBulk"\r\n      [class.hidden]="!selectionMultiple.hasValue()"\r\n    >\r\n      <span class="item-count">\r\n        ({{ selectionMultiple.selected.length }} Items Selected)\r\n        {{ isMaxReached() ? \' Max Reached!\' : \'\' }}\r\n      </span>\r\n      <span class="buttons flex-h align-center">\r\n        <button\r\n          mat-raised-button\r\n          *ngFor="let action of config.actionsBulk"\r\n          (click)="onClickBulkAction(action)"\r\n        >\r\n          <mat-icon>{{ action.icon }}</mat-icon>\r\n          <span>{{ action.label }}</span>\r\n        </button>\r\n      </span>\r\n    </div>\r\n  </div>\r\n</div>\r\n<table\r\n  mat-table\r\n  #table\r\n  matSort\r\n  [matSortActive]="config.initialSort"\r\n  [matSortDirection]="config.initialSortDir"\r\n  [dataSource]="this.dataSource"\r\n  style="width:100%;"\r\n  class="mat-elevation-z8"\r\n>\r\n  <ng-container\r\n    *ngFor="let def of columnDefinitionsAllArray"\r\n    [matColumnDef]="def.field"\r\n  >\r\n    <th mat-header-cell mat-sort-header *matHeaderCellDef>{{ def.header }}</th>\r\n    <td mat-cell *matCellDef="let row">\r\n      <div *ngIf="!def.template" [class.break-words]="def.forceWrap">\r\n        {{ row[def.field] }}\r\n      </div>\r\n      <div *ngIf="def.template">\r\n        <div\r\n          *ngTemplateOutlet="def.template; context: { $implicit: row }"\r\n        ></div>\r\n      </div>\r\n    </td>\r\n  </ng-container>\r\n\r\n  <ng-container matColumnDef="__bulk" stickyEnd>\r\n    <th mat-header-cell *matHeaderCellDef>\r\n      <mat-checkbox\r\n        (change)="$event ? masterToggle() : null"\r\n        [checked]="selectionMultiple.hasValue() && isAllSelected()"\r\n        [indeterminate]="selectionMultiple.hasValue() && !isAllSelected()"\r\n      >\r\n      </mat-checkbox>\r\n    </th>\r\n    <td mat-cell *matCellDef="let row">\r\n      <mat-checkbox\r\n        (click)="$event.stopPropagation()"\r\n        (change)="onClickBulkItem($event, row)"\r\n        [checked]="selectionMultiple.isSelected(row)"\r\n      >\r\n      </mat-checkbox>\r\n    </td>\r\n  </ng-container>\r\n\r\n  <ng-container matColumnDef="__star" stickyEnd>\r\n    <th mat-header-cell *matHeaderCellDef></th>\r\n    <td mat-cell *matCellDef="let row">\r\n      <div *ngIf="config.actions">\r\n        <mat-icon\r\n          mat-list-icon\r\n          class="more-icon has-pointer"\r\n          [matMenuTriggerFor]="rowMenu"\r\n          >more_vert</mat-icon\r\n        >\r\n        <mat-menu #rowMenu="matMenu" class="row-menu">\r\n          <div mat-menu-item *ngFor="let action of config.actions">\r\n            <button\r\n              mat-menu-item\r\n              *ngIf="action.onClick"\r\n              (click)="action.onClick(row)"\r\n            >\r\n              <mat-icon>{{ action.icon }}</mat-icon>\r\n              <span>{{ action.label }}</span>\r\n            </button>\r\n            <a\r\n              mat-menu-item\r\n              *ngIf="action.onRouterLink && !action.routerLinkQuery"\r\n              [routerLink]="[\'/\' + action.onRouterLink(row)]"\r\n            >\r\n              <mat-icon>{{ action.icon }}</mat-icon>\r\n              <span>{{ action.label }}</span>\r\n            </a>\r\n            <a\r\n              mat-menu-item\r\n              *ngIf="action.onRouterLink && action.routerLinkQuery"\r\n              [routerLink]="[\'/\' + action.onRouterLink(row)]"\r\n              [queryParams]="action.routerLinkQuery(row)"\r\n            >\r\n              <mat-icon>{{ action.icon }}</mat-icon>\r\n              <span>{{ action.label }}</span>\r\n            </a>\r\n          </div>\r\n        </mat-menu>\r\n      </div>\r\n    </td>\r\n  </ng-container>\r\n\r\n  <tr\r\n    mat-header-row\r\n    *matHeaderRowDef="headerKeysDisplayed"\r\n    [hidden]="config.hideHeader"\r\n  ></tr>\r\n  <tr\r\n    mat-row\r\n    *matRowDef="let row; columns: headerKeysDisplayed"\r\n    (click)="onClickRow($event, row)"\r\n    [class.selected-row-multiple]="selectionMultiple.isSelected(row)"\r\n    [class.selected-row-single]="selectionSingle.isSelected(row)"\r\n    [class.has-pointer]="config.onSelectItem"\r\n  ></tr>\r\n</table>\r\n\r\n<mat-toolbar class="mat-elevation-z8 overflow-hidden">\r\n  <mat-toolbar-row>\r\n    <app-toolbar-loader *ngIf="!dataSource"></app-toolbar-loader>\r\n    <h1 *ngIf="hasNoItems" class="no-items">No items found</h1>\r\n  </mat-toolbar-row>\r\n  <mat-toolbar-row\r\n    style="display: flex; align-items: centered; justify-content: space-between;"\r\n  >\r\n    <app-table-csv-export\r\n      *ngIf="exportFilename"\r\n      [dataArray]="exportData"\r\n      [filename]="exportFilename"\r\n    ></app-table-csv-export>\r\n    <mat-paginator [pageSize]="pageSize" [pageSizeOptions]="[5, 10, 25, 100]">\r\n    </mat-paginator>\r\n  </mat-toolbar-row>\r\n</mat-toolbar>\r\n',styles:[".no-items,app-toolbar-loader{text-align:center;padding:20px;width:100%}.no-items{color:#555}.addRightPixel{width:calc(100% - 1px)}.relative{position:relative}.overflow-hidden{overflow:hidden}.flex-h{display:flex;flex-direction:row}.space-between{justify-content:space-between}.align-center{align-items:center}.auto-elevation{box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.table-header{width:100%;background-color:#fff;margin-top:15px;height:70px}.table-header .filters-container .filter,.table-header .filters-container .filter-columns{margin:10px}.table-header .bulk-actions{position:absolute;top:0;transition:.7s;height:70px;background-color:#c4efb3;width:100%}.table-header .bulk-actions .item-count{color:#006400;padding-left:10px}.table-header .bulk-actions .buttons button{margin-right:10px}.hidden{top:-70px!important;overflow:hidden!important}.selected-row-multiple{background-color:#eee}.selected-row-single{background-color:#b5deb6}.break-words{word-break:break-all}.more-icon:hover{background-color:#d3d3d3;border-radius:20px}"]}]}],e.propDecorators={selectedBulk:[{type:a.Output}],config:[{type:a.Input}],columnDefinitions:[{type:a.Input}],paginator:[{type:a.ViewChild,args:[o.MatPaginator]}],sort:[{type:a.ViewChild,args:[o.MatSort]}]},e}(),f=function(){function e(){}return e.decorators=[{type:a.Component,args:[{selector:"app-toolbar-loader",template:'\n    <mat-toolbar-row>\n      <div class="loader-container is-button-icon">\n        <div class="loader-div">\n          <mat-spinner [diameter]="40"></mat-spinner>\n        </div>\n      </div>\n    </mat-toolbar-row>\n  ',styles:["\n      .loader-container {\n        width: 100% !important;\n        display: flex !important;\n        padding: 0px 0px;\n        z-index: 100000000;\n      }\n      .loader-div {\n        margin: auto;\n      }\n      .loader-container,\n      .is-button-icon {\n        display: inline-block;\n        margin: 0;\n        margin-bottom: -4px;\n        margin-right: 5px;\n      }\n    "]}]}],e}(),h=function(){function e(){}return e.decorators=[{type:a.Component,args:[{selector:"app-table-csv-export",template:'\n    <a\n      *ngIf="dataArray"\n      csvLink\n      [data]="dataArray"\n      [filename]="filename"\n      mat-raised-button\n    >\n      <mat-icon title="Export as CSV">file_download</mat-icon>\n      <span>Export CSV</span>\n    </a>\n  ',styles:["\n      a {\n        color: black;\n      }\n      mat-icon {\n        padding-right: 5px;\n      }\n    "]}]}],e.propDecorators={dataArray:[{type:a.Input}],filename:[{type:a.Input}]},e}(),m=[p,f],g=function(){function e(){}return e.decorators=[{type:a.NgModule,args:[{declarations:function n(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e}(m,[h]),exports:m,imports:[i.CsvModule,t.ReactiveFormsModule,o.MatAutocompleteModule,o.MatButtonModule,o.MatButtonToggleModule,o.MatCheckboxModule,o.MatFormFieldModule,o.MatIconModule,o.MatInputModule,o.MatMenuModule,o.MatPaginatorModule,o.MatProgressBarModule,o.MatProgressSpinnerModule,o.MatSelectModule,o.MatSortModule,o.MatTableModule,o.MatToolbarModule,l.CommonModule,s.RouterModule]}]}],e}();e.AutoTableModule=g,e.AutoTableComponent=p,e.ɵb=h,e.ɵa=f,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-auto-table-lib.umd.min.js.map